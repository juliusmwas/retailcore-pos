// Prisma schema for RetailCore POS

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  OWNER
  ADMIN
  MANAGER
  CASHIER
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

model Business {
  id        String   @id @default(uuid())
  name      String
  phone     String?
  country   String?
  industry  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  branches Branch[]
  users    User[]
}

model Branch {
  id       String  @id @default(uuid())
  name     String
  code     String  @unique
  type     String? // e.g., Retail, Warehouse
  location String?
  city     String?
  address  String?
  status   String  @default("ACTIVE")

  // Financials
  currency      String?  @default("KES")
  budget        Float    @default(0)
  revenueTarget Float    @default(0)
  openingDate   DateTime @default(now())

  businessId String
  business   Business @relation(fields: [businessId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  users UserBranch[]
}

model User {
  id          String     @id @default(uuid())
  staffNumber String     @unique // üîë Primary Login ID (Professional Requirement)
  fullName    String
  email       String     @unique
  password    String
  phone       String?
  status      UserStatus @default(ACTIVE) // üõ°Ô∏è Account State

  businessId String
  business   Business @relation(fields: [businessId], references: [id])

  branches  UserBranch[]
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
}

model UserBranch {
  id       String @id @default(uuid())
  userId   String
  branchId String
  role     Role   @default(CASHIER) // üîë Specific role per branch

  user   User   @relation(fields: [userId], references: [id])
  branch Branch @relation(fields: [branchId], references: [id])

  createdAt DateTime @default(now())

  @@unique([userId, branchId]) // üõ°Ô∏è Prevents duplicating a user in the same branch
}
