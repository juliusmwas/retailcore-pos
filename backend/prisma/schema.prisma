// Prisma schema for RetailCore POS

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  OWNER
  ADMIN
  MANAGER
  CASHIER
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

model Business {
  id        String   @id @default(uuid())
  name      String
  phone     String?
  country   String?
  industry  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  branches Branch[]
  users    User[]
}

model Branch {
  id            String   @id @default(uuid())
  name          String
  code          String   @unique
  type          String? // e.g., Retail, Warehouse
  status        String   @default("ACTIVE")
  
  // Location Details
  country       String?
  city          String?
  address       String?
  location      String?
  
  // Manager Details
  managerName   String?
  managerEmail  String?
  managerPhone  String?

  // Financials & Staffing
  currency      String?  @default("KES")
  taxRegion     String?
  initialStaff  Int      @default(0)
  maxStaff      Int      @default(20)
  budget        Float    @default(0)
  revenueTarget Float    @default(0)
  openingDate   DateTime @default(now())

  businessId    String
  business      Business @relation(fields: [businessId], references: [id])
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  users UserBranch[]
}

model User {
  id            String     @id @default(uuid())
  staffNumber   String?    @unique // ðŸ”‘ Now Optional (?) so Admin can register
  fullName      String
  email         String     @unique
  password      String
  phone         String?
  status        UserStatus @default(ACTIVE)
  
  businessId    String
  business      Business   @relation(fields: [businessId], references: [id])

  branches      UserBranch[]
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
}

model UserBranch {
  id        String @id @default(uuid())
  userId    String
  branchId  String
  role      Role   @default(CASHIER)

  user      User   @relation(fields: [userId], references: [id])
  branch    Branch @relation(fields: [branchId], references: [id])

  createdAt DateTime @default(now())

  @@unique([userId, branchId])
}